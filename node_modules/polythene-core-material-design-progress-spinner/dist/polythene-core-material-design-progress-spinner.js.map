{"version":3,"file":"polythene-core-material-design-progress-spinner.js","sources":["../../polythene-css-classes/material-design-progress-spinner.js","../src/spinner.js"],"sourcesContent":["\nexport default {\n  component:          \"pe-md-progress-spinner\",\n\n  // elements\n  animation:          \"pe-md-progress-spinner__animation\",\n  circle:             \"pe-md-progress-spinner__circle\",\n  circleRight:        \"pe-md-progress-spinner__circle-right\",\n  circleLeft:         \"pe-md-progress-spinner__circle-left\"\n};\n","import { unpackAttrs, getStyle, styleDurationToMs } from \"polythene-core\";\nimport { easing } from \"polythene-utilities\";\nimport classes from \"polythene-css-classes/material-design-progress-spinner\";\n\nconst percentageValue = (min, max, percentage = 0) => min + ((max - min) * percentage);\n\nconst rotateCircle = (el, min, max, percentage) => {\n  const style = el.style;\n  style[\"transform\"] =\n    style[\"-webkit-transform\"] =\n    style[\"-moz-transform\"] =\n    style[\"-ms-transform\"] =\n    style[\"-o-transform\"] = \"rotate(\" + percentageValue(min, max, percentage) + \"deg)\";\n};\n\nconst animate = (stateEl, size, percentage) => {\n  const animationEl = stateEl.querySelector(\".\" + classes.animation);\n  const animationElStyle = animationEl.style;\n  if (percentage < 0.5) {\n    animationElStyle.clip = \"rect(0px, \" + size + \"px, \" + size + \"px, \" + size / 2 + \"px)\";\n  } else {\n    animationElStyle.clip = \"rect(auto, auto, auto, auto)\";\n  }\n  const leftCircle = stateEl.querySelector(\".\" + classes.circleLeft);\n  const rightCircle = stateEl.querySelector(\".\" + classes.circleRight);\n  leftCircle.style.clip = rightCircle.style.clip = \"rect(0px, \" + size / 2 + \"px, \" + size + \"px, \" + \"0px)\";\n  rotateCircle(rightCircle, 0, 180, Math.min(1, percentage * 2));\n  rotateCircle(leftCircle, 0, 360, percentage);\n};\n\nconst updateWithPercentage = ({ state, attrs, size }) => {\n  if (!state.dom) {\n    return;\n  }\n  if (state.animating()) {\n    return;\n  }\n  if (attrs.percentage === undefined) {\n    return;\n  }\n  const percentage = unpackAttrs(attrs.percentage);\n  const previousPercentage = state.percentage();\n  const easingFn = attrs.animated\n    ? easing.easeInOutQuad\n    : v => v;\n  if (attrs.animated && previousPercentage !== percentage) {\n    const el = state.dom;\n    const animationDuration = attrs.updateDuration !== undefined\n      ? attrs.updateDuration * 1000\n      : styleDurationToMs(getStyle({ element: el.querySelector(`.${classes.animation}`), prop: \"animation-duration\" }));\n    let start = null;\n    const step = timestamp => {\n      if (!start) start = timestamp;\n      const progress = timestamp - start;\n      const stepPercentage = 1.0 / animationDuration * progress;\n      const newPercentage = previousPercentage + stepPercentage * (percentage - previousPercentage);\n      animate(el, size, easingFn(newPercentage));\n      if (start && progress < animationDuration) {\n        window.requestAnimationFrame(step);\n      } else {\n        start = null;\n        state.percentage(percentage);\n        state.animating(false);\n      }\n    };\n    state.animating(true);\n    window.requestAnimationFrame(step);\n  } else {\n    animate(state.dom, size, easingFn(percentage));\n    state.percentage(percentage);\n  }\n};\n\nconst getSize = element => \n  Math.round(\n    element\n      ? parseFloat(getStyle({ element, prop: \"height\" })) - 2 * parseFloat(getStyle({ element, prop: \"padding\" }))\n      : 0\n  );\n\nexport const getInitialState = (vnode, createStream) => {\n  const percentage = createStream(0);\n  const animating = createStream(false);\n  return {\n    animating,\n    dom: undefined,\n    percentage,\n    redrawOnUpdate: createStream.merge([animating])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.dom = vnode.dom;\n  const size = getSize(state.dom);\n  updateWithPercentage({ state, attrs, size });\n};\n\nexport const createProps = (vnode, { renderer: h }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  const size = getSize(state.dom);\n  updateWithPercentage({ state, attrs, size });\n\n  const content = h(\"div\",\n    {\n      key: \"content\",\n      className: classes.animation,\n      style: {\n        width: size + \"px\",\n        height: size + \"px\"\n      }\n    },\n    [\n      h(\"div\", {\n        key: \"left\",\n        className: [classes.circle, classes.circleLeft].join(\" \")\n      }),\n      h(\"div\", {\n        key: \"right\",\n        className: [classes.circle, classes.circleRight].join(\" \")\n      })\n    ]\n  );\n\n  return Object.assign(\n    {},\n    attrs,\n    {\n      className: [classes.component, attrs.className].join(\" \"),\n      content\n    }\n  );\n};\n"],"names":["component","animation","circle","circleRight","circleLeft","percentageValue","min","max","percentage","rotateCircle","el","style","animate","stateEl","size","animationEl","querySelector","classes","animationElStyle","clip","leftCircle","rightCircle","Math","updateWithPercentage","state","attrs","dom","animating","undefined","unpackAttrs","previousPercentage","easingFn","animated","easing","easeInOutQuad","v","animationDuration","updateDuration","styleDurationToMs","getStyle","element","prop","start","step","timestamp","progress","stepPercentage","newPercentage","window","requestAnimationFrame","getSize","round","parseFloat","getInitialState","vnode","createStream","redrawOnUpdate","merge","onMount","createProps","h","renderer","content","key","className","width","height","join"],"mappings":"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"}