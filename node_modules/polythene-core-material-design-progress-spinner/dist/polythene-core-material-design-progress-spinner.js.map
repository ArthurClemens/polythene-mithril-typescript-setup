{"version":3,"file":"polythene-core-material-design-progress-spinner.js","sources":["../src/vars.js","../../polythene-css-classes/material-design-progress-spinner.js","../src/spinner.js"],"sourcesContent":["import { vars } from \"polythene-theme\";\nimport { vars as baseVars } from \"polythene-core-base-spinner\";\n\nconst rgba = (colorStr, opacity = 1) =>\n  `rgba(${colorStr}, ${opacity})`;\n  \nexport default Object.assign(\n  {},\n  baseVars,\n  {\n    border_width_small:   baseVars.size_small / baseVars.size_regular * 3,\n    border_width_regular: 3,\n    border_width_medium:  baseVars.size_medium / baseVars.size_regular * 3,\n    border_width_large:   baseVars.size_large / baseVars.size_regular * 3,\n    border_width_fab:     baseVars.size_fab / baseVars.size_regular * 3,\n    animation_duration:   \"1.5s\",\n\n    color_light:          rgba(vars.color_primary),\n    color_dark:           rgba(vars.color_primary)\n  }\n);\n","\nexport default {\n  component:          \"pe-md-progress-spinner\",\n\n  // elements\n  animation:          \"pe-md-progress-spinner__animation\",\n  circle:             \"pe-md-progress-spinner__circle\",\n  circleRight:        \"pe-md-progress-spinner__circle-right\",\n  circleLeft:         \"pe-md-progress-spinner__circle-left\"\n};\n","import { unpackAttrs } from \"polythene-core\";\nimport { easing } from \"polythene-utilities\";\nimport themeVars from \"./vars\";\nimport classes from \"polythene-css-classes/material-design-progress-spinner\";\n\nconst DEFAULT_UPDATE_DURATION = .8;\n\nconst sizeFromName = (size = \"regular\") => themeVars[\"size_\" + size];\n\nconst percentageValue = (min, max, percentage = 0) => min + ((max - min) * percentage);\n\nconst rotateCircle = (el, min, max, percentage) => {\n  const style = el.style;\n  style[\"transform\"] =\n    style[\"-webkit-transform\"] =\n    style[\"-moz-transform\"] =\n    style[\"-ms-transform\"] =\n    style[\"-o-transform\"] = \"rotate(\" + percentageValue(min, max, percentage) + \"deg)\";\n};\n\nconst animate = (stateEl, size, percentage) => {\n  const animationEl = stateEl.querySelector(\".\" + classes.animation);\n  const animationElStyle = animationEl.style;\n  if (percentage < 0.5) {\n    animationElStyle.clip = \"rect(0px, \" + size + \"px, \" + size + \"px, \" + size / 2 + \"px)\";\n  } else {\n    animationElStyle.clip = \"rect(auto, auto, auto, auto)\";\n  }\n  const leftCircle = stateEl.querySelector(\".\" + classes.circleLeft);\n  const rightCircle = stateEl.querySelector(\".\" + classes.circleRight);\n  leftCircle.style.clip = rightCircle.style.clip = \"rect(0px, \" + size / 2 + \"px, \" + size + \"px, \" + \"0px)\";\n  rotateCircle(rightCircle, 0, 180, Math.min(1, percentage * 2));\n  rotateCircle(leftCircle, 0, 360, percentage);\n};\n\nconst handlePercentage = (percentage, state, size, attrs) => {\n  if (!state.dom()) {\n    return;\n  }\n  if (state.animating()) {\n    return;\n  }\n  const previousPercentage = state.percentage();\n  if (attrs.animated && previousPercentage !== percentage) {\n    const animationDuration = (attrs.updateDuration || DEFAULT_UPDATE_DURATION) * 1000;\n    const el = state.dom();\n    let start = null;\n    const step = timestamp => {\n      if (!start) start = timestamp;\n      const progress = timestamp - start;\n      const stepPercentage = 1.0 / animationDuration * progress;\n      const newPercentage = previousPercentage + stepPercentage * (percentage - previousPercentage);\n      animate(el, size, easing.easeInOutQuad(newPercentage));\n      if (start && progress < animationDuration) {\n        window.requestAnimationFrame(step);\n      } else {\n        start = null;\n        state.percentage(percentage);\n        state.animating(false);\n      }\n    };\n    state.animating(true);\n    window.requestAnimationFrame(step);\n  } else {\n    animate(state.dom(), size, percentage);\n    state.percentage(percentage);\n  }\n};\n\nconst notifyState = (state, attrs, size) => {\n  if (attrs.percentage !== undefined) {\n    const percentage = unpackAttrs(attrs.percentage);\n    handlePercentage(percentage, state, size, attrs);\n  }\n};\n\nconst getSize = attrs => {\n  const rawSize = sizeFromName(attrs.size);\n  const { padding, paddedSize } = themeVars.raisedSize(rawSize);\n  return attrs.raised\n    ? paddedSize - 2 * padding\n    : rawSize;\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const percentage = createStream(0);\n  const dom = createStream(null);\n  const animating = createStream(false);\n  return {\n    dom,\n    percentage,\n    animating\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.dom(vnode.dom);\n  const size = getSize(attrs);\n  notifyState(state, attrs, size);\n};\n\nexport const createProps = (vnode, { renderer: h }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  const size = getSize(attrs);\n  notifyState(state, attrs, size);\n\n  const content = h(\"div\",\n    {\n      key: \"content\",\n      className: classes.animation,\n      style: {\n        width: size + \"px\",\n        height: size + \"px\"\n      }\n    },\n    [\n      h(\"div\", {\n        key: \"left\",\n        className: [classes.circle, classes.circleLeft].join(\" \")\n      }),\n      h(\"div\", {\n        key: \"right\",\n        className: [classes.circle, classes.circleRight].join(\" \")\n      })\n    ]\n  );\n\n  return Object.assign(\n    {},\n    attrs,\n    {\n      className: [classes.component, attrs.className].join(\" \"),\n      content\n    }\n  );\n};\n"],"names":["rgba","colorStr","opacity","baseVars","border_width_small","size_small","size_regular","border_width_regular","border_width_medium","size_medium","border_width_large","size_large","border_width_fab","size_fab","animation_duration","color_light","vars","color_primary","color_dark","component","animation","circle","circleRight","circleLeft","DEFAULT_UPDATE_DURATION","sizeFromName","size","themeVars","percentageValue","min","max","percentage","rotateCircle","el","style","animate","stateEl","animationEl","querySelector","classes","animationElStyle","clip","leftCircle","rightCircle","Math","handlePercentage","state","attrs","dom","animating","previousPercentage","animated","animationDuration","updateDuration","start","step","timestamp","progress","stepPercentage","newPercentage","easing","easeInOutQuad","window","requestAnimationFrame","notifyState","undefined","unpackAttrs","getSize","rawSize","raisedSize","padding","paddedSize","raised","getInitialState","vnode","createStream","onMount","createProps","h","renderer","content","key","className","width","height","join","_extends"],"mappings":"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"}