{"version":3,"file":"polythene-core-ripple.js","sources":["../src/animation.js","../../polythene-css-classes/ripple.js","../src/ripple.js","../src/vars.js"],"sourcesContent":["import { isTouch, getAnimationEndEvent, isServer } from \"polythene-core\";\nimport { vars } from \"polythene-theme\";\n\nconst ANIMATION_END_EVENT =    getAnimationEndEvent();\nconst DEFAULT_START_OPACITY =  0.2;\nconst DEFAULT_END_OPACITY =    0.0;\nconst DEFAULT_START_SCALE =    0.1;\nconst DEFAULT_END_SCALE =      2.0;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nconst addStyleToHead = (id, stylesheet) => {\n  if (isServer) return;\n  const documentRef = window.document;\n  const styleEl = documentRef.createElement(\"style\");\n  styleEl.setAttribute(\"id\", id);\n  styleEl.appendChild(documentRef.createTextNode(stylesheet));\n  documentRef.head.appendChild(styleEl);\n};\n\nconst removeStyleFromHead = id => {\n  if (isServer) return;\n  const el = document.getElementById(id);\n  if (el && el.parentNode) {\n    el.parentNode.removeChild(el);\n  }\n};\n\nexport default ({ e, id, el, attrs, classes }) => {\n  return new Promise(resolve => {\n    const container = document.createElement(\"div\");\n    container.setAttribute(\"class\", classes.mask);\n    el.appendChild(container);\n    const waves = document.createElement(\"div\");\n    waves.setAttribute(\"class\", classes.waves);\n    container.appendChild(waves);\n    const rect = el.getBoundingClientRect();\n    const x = (isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (isTouch && e.touches) ? e.touches[0].pageY : e.clientY;  \n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const mx = (attrs.center) ? (rect.left + rect.width / 2) : x;\n    const my = (attrs.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const startOpacity = attrs.startOpacity !== undefined\n      ? attrs.startOpacity\n      : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = attrs.opacityDecayVelocity !== undefined\n      ? attrs.opacityDecayVelocity\n      : OPACITY_DECAY_VELOCITY;\n    const endOpacity = attrs.endOpacity || DEFAULT_END_OPACITY;\n    const startScale = attrs.startScale || DEFAULT_START_SCALE;\n    const endScale = attrs.endScale || DEFAULT_END_SCALE;\n    const duration = attrs.duration\n      ? attrs.duration\n      : 1 / opacityDecayVelocity * 0.2;\n    const color = window.getComputedStyle(el).color;\n    \n    const style = waves.style;\n    style.width = style.height = waveRadius + \"px\";\n    style.top = ry + \"px\";\n    style.left = rx + \"px\";\n    style[\"animation-duration\"] =\n      style[\"-webkit-animation-duration\"] =\n      style[\"-moz-animation-duration\"] =\n      style[\"-o-animation-duration\"] = duration + \"s\";\n    style.backgroundColor = color;\n    style.opacity = startOpacity;\n    style.animationName = id;\n    style.animationTimingFunction = attrs.animationTimingFunction || vars.animation_curve_default;\n\n    const rippleStyleSheet = `@keyframes ${id} {\n      0% {\n        transform:scale(${startScale});\n        opacity: ${startOpacity}\n      }\n      100% {\n        transform:scale(${endScale});\n        opacity: ${endOpacity};\n      }\n    }`;\n    addStyleToHead(id, rippleStyleSheet);\n\n    const animationDone = evt => {\n      removeStyleFromHead(id);\n      waves.removeEventListener(ANIMATION_END_EVENT, animationDone, false);\n      if (attrs.persistent) {\n        style.opacity = endOpacity;\n        style.transform = \"scale(\" + endScale + \")\";\n      } else {\n        waves.classList.remove(classes.wavesAnimating);\n        container.removeChild(waves);\n        el.removeChild(container);\n      }\n      resolve(evt);\n    };\n\n    waves.addEventListener(ANIMATION_END_EVENT, animationDone, false);\n    waves.classList.add(classes.wavesAnimating);\n  });\n};\n","\nexport default {\n  component:      \"pe-ripple\",\n\n  // elements\n  mask:           \"pe-ripple__mask\",\n  waves:          \"pe-ripple__waves\",\n\n  // states\n  unconstrained:  \"pe-ripple--unconstrained\",\n  wavesAnimating: \"pe-ripple__waves--animating\",\n};\n","import { pointerEndEvent, filterSupportedAttributes, isServer } from \"polythene-core\";\nimport animation from \"./animation\";\nimport classes from \"polythene-css-classes/ripple\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nexport const getInitialState = () => {\n  return {\n    animations: {},\n    animating: false,\n    cleanUp: undefined\n  };\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  return Object.assign(\n    {},\n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.unconstrained ? classes.unconstrained : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nconst updateAnimationState = state =>\n  state.animating = Object.keys(state.animations).length > 0;\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  if (isServer) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  const tap = e => {\n    if (attrs.disabled || (!attrs.multi && state.animating)) {\n      return;\n    }\n    if (attrs.start) {\n      attrs.start(e);\n    }\n    const id = `ripple_animation_${new Date().getTime()}`;\n    state.animations[id] = animation({ e, id, el: vnode.dom, attrs, classes })\n      .then(evt => {\n        if (attrs.end) {\n          attrs.end(evt);\n        }\n        delete state.animations[id];\n        updateAnimationState(state);\n      });\n    updateAnimationState(state);\n  };\n  const triggerEl = attrs.target\n    ? attrs.target\n    : vnode.dom && vnode.dom.parentElement;\n\n  if (triggerEl) {\n    pointerEndEvent.forEach(evt =>\n      triggerEl.addEventListener(evt, tap, false));\n  }\n  state.cleanUp = () => {\n    if (triggerEl) {\n      pointerEndEvent.forEach(evt =>\n        triggerEl.removeEventListener(evt, tap, false));\n    }\n  };\n};\n\nexport const onUnMount = ({ state }) =>\n  state.cleanUp && state.cleanUp();\n","export default {\n  color:         \"inherit\" // only specify this variable to get both states\n  // color_light:   \"inherit\",\n  // color_dark:    \"inherit\"\n};"],"names":["ANIMATION_END_EVENT","getAnimationEndEvent","DEFAULT_START_OPACITY","DEFAULT_END_OPACITY","DEFAULT_START_SCALE","DEFAULT_END_SCALE","OPACITY_DECAY_VELOCITY","addStyleToHead","id","stylesheet","isServer","documentRef","window","document","styleEl","createElement","setAttribute","appendChild","createTextNode","head","removeStyleFromHead","el","getElementById","parentNode","removeChild","e","attrs","classes","Promise","container","mask","waves","rect","getBoundingClientRect","x","isTouch","touches","pageX","clientX","y","pageY","clientY","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","mx","center","left","width","my","top","height","rx","ry","startOpacity","undefined","opacityDecayVelocity","endOpacity","startScale","endScale","duration","color","getComputedStyle","style","backgroundColor","opacity","animationName","animationTimingFunction","vars","animation_curve_default","rippleStyleSheet","animationDone","removeEventListener","persistent","transform","classList","remove","wavesAnimating","resolve","evt","addEventListener","add","component","unconstrained","getElement","vnode","element","getInitialState","animations","animating","cleanUp","createProps","k","keys","filterSupportedAttributes","className","tone","class","join","updateAnimationState","state","Object","length","onMount","dom","tap","disabled","multi","start","Date","getTime","animation","then","end","triggerEl","target","parentElement","pointerEndEvent","forEach","onUnMount"],"mappings":"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"}