<!doctype html>
<title>j2c prefix plugin live test</title>
<script src='../../../dist/j2c.global.js'></script>
<script src='../dist/j2c-plugin-prefix-browser.global.js'></script>
<h1>j2c-plugin-prefix-browser in action in your browser</h1>
<pre id="source"></pre>
<pre id="prefixed"></pre>
<script>
var src = {
  '@global': {
    '@keyframes rotate': {
      'from': {
        transform: 'rotate(15deg)'
      },
      'to': {
        transform: 'rotate(375deg)'
      }
    },
    '@supports (display:flex)':{
       ':read-write ::placeholder': {
          display: 'flex',
          flex: '1 1',
          flexFlow: 'column-reverse wrap'
      },
    },
    '@media (min-resolution:2dppx)' : {
     '.download': {
        backgroundImage: 'linear-gradient(90deg, red, rgba(calc(10 * 2),0,0,.3))',
        color: 'white',
        textDecoration: 'initial',
        textShadow: '.08em .08em .2em rgba(0,0,0,.6)',
        borderRadius: '50%',
        boxShadow: '.1em .2em .4em -.2em black',
        boxSizing: 'border-box',
        transform: 'rotate(15deg)',
        animation: 'rotate',
        cursor: 'zoom-in'
      }        
    }
  }
}
var buf, err, indent

// the bottom of the 'codegen' stream. Mirrors the `$filter` plugin API.
var sink = {$sink: {
  init: function(){buf=[], err=0, indent = ''},
  done: function (raw) {
    if (err) throw new Error('j2c error, see below\n' + buf.join(''))
    return raw ? buf : buf.join('')
  },
  err: function(msg) {
    err = 1
    buf.push('/* +++ ERROR +++ ' + msg + ' */\n')
  },
  atrule: function (rule, kind, param, takesBlock) {
    buf.push(indent, rule, param && ' ', param, takesBlock ? ' {' : ';', '\n')
    if (takesBlock) indent = indent + '    '
  },
  // close atrule
  _atrule: function () {
    indent = indent.slice(4)
    buf.push(indent, '}', '\n')
  },
  rule: function (selector) {
    buf.push(indent, selector, ' {', '\n')
    indent = indent + '    '
  },

  // close rule
  _rule: function () {
    indent = indent.slice(4)
    buf.push(indent, '}', '\n')
  },
  decl: function (prop, value) {buf.push(indent, prop, prop && ': ', value, ';', '\n')}
}}

var rawstyler = j2c(sink) 
var prefixer = j2c(j2cPrefixPluginBrowser.prefixPlugin(), sink)
document.getElementById('source').textContent = '// output without the plugin\n' + rawstyler.sheet(src)
document.getElementById('prefixed').textContent = '//prefixed\n' + prefixer.sheet(src)
</script>
<style>
pre {
    float:left;
    width:49%;
    height:50em;
    font-family: monospace;
}
</style>