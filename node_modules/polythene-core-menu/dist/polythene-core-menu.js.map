{"version":3,"file":"polythene-core-menu.js","sources":["../../polythene-css-classes/list-tile.js","../../polythene-css-classes/menu.js","../src/menu.js"],"sourcesContent":["\nexport default {\n  component:       \"pe-list-tile\",\n\n  // elements\n  content:         \"pe-list-tile__content\",\n  highSubtitle:    \"pe-list-tile__high-subtitle\",\n  primary:         \"pe-list-tile__primary\",\n  secondary:       \"pe-list-tile__secondary\",\n  subtitle:        \"pe-list-tile__subtitle\",\n  title:           \"pe-list-tile__title\",\n  contentFront:    \"pe-list-tile__content-front\",\n\n  // states\n  compact:         \"pe-list-tile--compact\",\n  compactFront:    \"pe-list-tile--compact-front\",\n  disabled:        \"pe-list-tile--disabled\",\n  hasFront:        \"pe-list-tile--front\",\n  hasHighSubtitle: \"pe-list-tile--high-subtitle\",\n  hasSubtitle:     \"pe-list-tile--subtitle\",\n  header:          \"pe-list-tile--header\",\n  hoverable:       \"pe-list-tile--hoverable\",\n  selectable:      \"pe-list-tile--selectable\",\n  selected:        \"pe-list-tile--selected\",\n  highlight:       \"pe-list-tile--highlight\",\n  sticky:          \"pe-list-tile--sticky\",\n  navigation:      \"pe-list-tile--navigation\",\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, isServer, pointerEndMoveEvent, deprecation, stylePropCompare } from \"polythene-core\";\nimport classes from \"polythene-css-classes/menu\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst DEFAULT_OFFSET_H           = 0;\nconst DEFAULT_OFFSET_V           = \"79%\";\nconst DEFAULT_TYPE               = \"floating\";\nconst MIN_WIDTH                   = 1.5;\nconst DEFAULT_SHADOW_DEPTH                   = 1;\n\nconst isTopMenu = ({ state, attrs }) =>\n  attrs.topMenu || stylePropCompare({\n    element: state.dom(),\n    pseudoSelector: \":before\",\n    prop: \"content\",\n    contains: `\"${\"top_menu\"}\"`\n  });\n\nconst positionMenu = (state, attrs) => {\n  if (isServer) {\n    return;\n  }\n  if (!attrs.target) {\n    return;\n  }\n  const targetEl = document.querySelector(attrs.target);\n  if (!targetEl) {\n    return;\n  }\n  const panelEl = state.panelEl;\n  if (!panelEl) {\n    return;\n  }\n\n  // Don't set the position or top offset if the menu position is fixed\n  const hasStylePositionFixed = stylePropCompare({\n    element: panelEl,\n    prop: \"position\",\n    equals: \"fixed\"\n  });\n\n  if (hasStylePositionFixed && !isTopMenu({ state, attrs })) {\n    Object.assign(panelEl.style, {});\n    panelEl.offsetHeight; // force reflow\n    return;\n  }\n\n  const contentEl = state.contentEl;\n  const parentRect = panelEl.parentNode.getBoundingClientRect();\n  const targetRect = targetEl.getBoundingClientRect();\n  const attrsOffsetH = attrs.offsetH !== undefined\n    ? attrs.offsetH\n    : attrs.offset !== undefined\n      ? attrs.offset // deprecated\n      : DEFAULT_OFFSET_H;\n  const attrsOffsetV = attrs.offsetV !== undefined\n    ? attrs.offsetV\n    : DEFAULT_OFFSET_V;\n  const offsetH = attrsOffsetH.toString().indexOf(\"%\") !== -1\n    ? Math.round(parseFloat(attrsOffsetH) * 0.01 * targetRect.width)\n    : Math.round(parseFloat(attrsOffsetH));\n  const offsetV = attrsOffsetV.toString().indexOf(\"%\") !== -1\n    ? Math.round(parseFloat(attrsOffsetV) * 0.01 * targetRect.height)\n    : Math.round(parseFloat(attrsOffsetV));\n  let positionOffsetV = offsetV;\n\n  const attrsOrigin = attrs.origin || \"top\";\n  const origin = attrsOrigin.split(/\\W+/).reduce((acc, curr) => (\n    acc[curr] = true,\n    acc\n  ), {});\n\n  const firstItem = contentEl.querySelectorAll(\".\" + classes.listTile)[0];\n\n  if (attrs.reposition) {\n    // get the first List Tile to calculate the top position  \n    const selectedItem = contentEl.querySelector(\".\" + classes.selectedListTile);\n    if (firstItem && selectedItem) {\n      // calculate v position: menu should shift upward relative to the first item\n      const firstItemRect = firstItem.getBoundingClientRect();\n      const selectedItemRect = selectedItem.getBoundingClientRect();\n      positionOffsetV = firstItemRect.top - selectedItemRect.top;\n    }\n    // align to middle of target\n    const alignEl = selectedItem || firstItem;\n    const alignRect = alignEl.getBoundingClientRect();\n    const targetRect = targetEl.getBoundingClientRect();\n    const heightDiff = targetRect.height - alignRect.height;\n    positionOffsetV += Math.abs(heightDiff) / 2;\n  } else if (attrs.origin && !hasStylePositionFixed) {\n    if (origin.top) {\n      positionOffsetV += targetRect.top - parentRect.top;\n    } else if (origin.bottom) {\n      positionOffsetV += targetRect.top - parentRect.bottom;\n    }\n  }\n\n  if (attrs.height) {\n    const firstItemHeight = firstItem\n      ? firstItem.clientHeight\n      : 48; // default List Tile height\n    if (attrs.height === \"max\") {\n      const topMargin = positionOffsetV;\n      const bottomMargin = firstItemHeight;\n      panelEl.style.height = `calc(100% - ${topMargin + bottomMargin}px)`;\n    } else {\n      const height = /^\\d+$/.test(attrs.height.toString())\n        ? `${attrs.height}px`\n        : attrs.height;\n      panelEl.style.height = height;\n    }\n  }\n\n  // prevent animated changes\n  const transitionDuration = panelEl.style.transitionDuration;\n  panelEl.style.transitionDuration = \"0ms\";\n\n  if (panelEl.parentNode && !hasStylePositionFixed) {\n    if (origin.right) {\n      panelEl.style.right = targetRect.right - parentRect.right + offsetH + \"px\";\n    } else {\n      panelEl.style.left = targetRect.left - parentRect.left + offsetH + \"px\";\n    }\n    if (origin.bottom) {\n      panelEl.style.bottom = positionOffsetV + \"px\";\n    } else {\n      panelEl.style.top = positionOffsetV + \"px\";\n    }\n    panelEl.style.transformOrigin = attrsOrigin.split(/\\W+/).join(\" \");\n  }\n\n  panelEl.offsetHeight; // force reflow\n  panelEl.style.transitionDuration = transitionDuration;\n};\n\nconst scrollContent = (state, attrs) => {\n  if (isServer) {\n    return;\n  }\n  if (!attrs.scrollTarget) {\n    return;\n  }\n  const scrollTargetEl = document.querySelector(attrs.scrollTarget);\n  if (!scrollTargetEl) {\n    return;\n  }\n  state.contentEl.scrollTop = scrollTargetEl.offsetTop;\n};\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  state,\n  attrs,\n  isShow,\n  beforeTransition: isShow\n    ? () => state.update()\n    : null,\n  domElements: {\n    el: state.panelEl,\n    showClassElement: state.dom(),\n  },\n  showClass: classes.visible,\n});\n\nconst showMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nconst unifyWidth = width =>\n  width < MIN_WIDTH ? MIN_WIDTH : width;\n\nconst widthClass = size =>\n  classes.width_n + size.toString().replace(\".\", \"-\");\n\nconst handleSubscriptions = (vnode, which) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  if (which === \"mount\") {\n    subscribe(\"resize\", state.update);\n    subscribe(\"keydown\", state.handleEscape);\n    setTimeout(() => {\n      state.activateDismissTap();\n      showMenu(state, attrs);\n    }, 0);\n  } else {\n    unsubscribe(\"resize\", state.update);\n    unsubscribe(\"keydown\", state.handleEscape);\n    state.deActivateDismissTap();\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const dom = createStream(null);\n  const attrs = vnode.attrs;\n  if (attrs.offset !== undefined) {\n    deprecation(\"Menu\", { option: \"offset\", newOption: \"offsetH\" });\n  }\n  if (attrs.size !== undefined) {\n    deprecation(\"Menu\", { option: \"size\", newOption: \"width\" });\n  }\n  const visible = createStream(false);\n  const transitioning = createStream(false);\n  return {\n    dom,\n    visible,\n    transitioning,\n    activateDismissTap: undefined, // set in onMount\n    contentEl: undefined, // set in onMount\n    deActivateDismissTap: undefined, // set in onMount\n    handleDismissTap: undefined, // set in onMount\n    handleEscape: undefined, // set in onMount\n    panelEl: undefined, // set in onMount\n    update: undefined, // set in onMount\n    redrawOnUpdate: createStream.merge([transitioning])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.dom(vnode.dom);\n  state.panelEl = vnode.dom.querySelector(`.${classes.panel}`);\n  state.contentEl = vnode.dom.querySelector(`.${classes.content}`);\n\n  if (!attrs.permanent) {\n    state.handleDismissTap = e => {\n      if (e.target === state.panelEl) {\n        return;\n      }\n      hideMenu(state, attrs);\n    };\n\n    state.update = () => {\n      positionMenu(state, attrs);\n      scrollContent(state, attrs);\n    };\n\n    state.activateDismissTap = () => {\n      pointerEndMoveEvent.forEach(evt =>\n        document.addEventListener(evt, state.handleDismissTap));\n    };\n\n    state.deActivateDismissTap = () => {\n      pointerEndMoveEvent.forEach(evt =>\n        document.removeEventListener(evt, state.handleDismissTap));\n    };\n\n    state.handleEscape = e => {\n      if (e.key === \"Escape\" || e.key === \"Esc\") {\n        hideMenu(state, Object.assign(\n          {},\n          attrs,\n          { hideDelay: 0 }\n        ));\n      }\n    };\n\n    handleSubscriptions(vnode, \"mount\");\n  }\n};\n\nexport const onUnMount = vnode => {\n  const attrs = vnode.attrs;\n  if (!attrs.permanent) {\n    handleSubscriptions(vnode, \"unmount\");\n  }\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  const type = attrs.type || DEFAULT_TYPE;\n  return Object.assign(\n    {}, \n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.permanent ? classes.permanent : null,\n        attrs.origin ? classes.origin : null,\n        attrs.backdrop ? classes.showBackdrop : null,\n        attrs.topMenu ? classes.isTopMenu : null,\n        type === \"floating\" && !attrs.permanent ? classes.floating : null,\n        attrs.width || attrs.size ? widthClass(unifyWidth(attrs.width || attrs.size)) : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, Shadow }) => {\n  const attrs = vnode.attrs;\n  const shadowDepth = attrs.shadowDepth !== undefined\n    ? attrs.shadowDepth\n    : attrs.z !== undefined \n      ? attrs.z // deprecated\n      : DEFAULT_SHADOW_DEPTH; \n  return [\n    h(\"div\",\n      {\n        key: \"backdrop\",\n        className: classes.backdrop,\n      }\n    ),\n    h(\"div\",\n      {\n        className: classes.panel,\n        key: \"panel\",\n      },\n      [\n        h(Shadow, {\n          shadowDepth,\n          animated: true,\n          key: \"shadow\",\n        }),\n        h(\"div\", \n          {\n            className: classes.content,\n            style: attrs.style,\n            key: \"content\",\n          },\n          attrs.content\n            ? attrs.content\n            : vnode.children\n        )\n      ]\n    )\n  ];\n};"],"names":["component","content","highSubtitle","primary","secondary","subtitle","title","contentFront","compact","compactFront","disabled","hasFront","hasHighSubtitle","hasSubtitle","header","hoverable","selectable","selected","highlight","sticky","navigation","panel","placeholder","backdrop","floating","origin","permanent","showBackdrop","visible","width_auto","width_n","isTopMenu","listTile","listTileClasses","selectedListTile","getElement","vnode","attrs","element","DEFAULT_OFFSET_H","DEFAULT_OFFSET_V","DEFAULT_TYPE","MIN_WIDTH","DEFAULT_SHADOW_DEPTH","state","topMenu","stylePropCompare","dom","pseudoSelector","prop","contains","positionMenu","isServer","target","targetEl","document","querySelector","panelEl","hasStylePositionFixed","equals","style","offsetHeight","contentEl","parentRect","parentNode","getBoundingClientRect","targetRect","attrsOffsetH","offsetH","undefined","offset","attrsOffsetV","offsetV","toString","indexOf","Math","round","parseFloat","width","height","positionOffsetV","attrsOrigin","split","reduce","acc","curr","firstItem","querySelectorAll","classes","reposition","selectedItem","firstItemRect","selectedItemRect","top","alignEl","alignRect","heightDiff","abs","bottom","firstItemHeight","clientHeight","topMargin","bottomMargin","test","transitionDuration","right","left","transformOrigin","join","scrollContent","scrollTarget","scrollTargetEl","scrollTop","offsetTop","transitionOptions","isShow","beforeTransition","update","domElements","el","showClassElement","showClass","showMenu","transitionComponent","hideMenu","unifyWidth","widthClass","size","replace","handleSubscriptions","which","subscribe","handleEscape","setTimeout","activateDismissTap","unsubscribe","deActivateDismissTap","getInitialState","createStream","deprecation","option","newOption","transitioning","handleDismissTap","redrawOnUpdate","merge","onMount","e","pointerEndMoveEvent","forEach","addEventListener","evt","removeEventListener","key","hideDelay","onUnMount","createProps","k","keys","type","filterSupportedAttributes","className","tone","class","createContent","h","renderer","Shadow","shadowDepth","z","animated","children"],"mappings":"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"}