{"version":3,"file":"polythene-core-slider.js","sources":["../../polythene-css-classes/slider.js","../src/slider.js"],"sourcesContent":["\nexport default {\n  component:      \"pe-slider\",\n\n  // elements\n  control:        \"pe-slider__control\",\n  label:          \"pe-slider__label\",\n  pin:            \"pe-slider__pin\",\n  thumb:          \"pe-slider__thumb\",\n  tick:           \"pe-slider__tick\",\n  ticks:          \"pe-slider__ticks\",\n  track:          \"pe-slider__track\",\n  trackBar:       \"pe-slider__track-bar\",\n  trackBarValue:  \"pe-slider__track-bar-value\",\n  trackPart:      \"pe-slider__track-part\",\n  trackPartRest:  \"pe-slider__track-rest\",\n  trackPartValue: \"pe-slider__track-value\",\n\n  // states\n  hasFocus:       \"pe-slider--focus\",\n  hasPin:         \"pe-slider--pin\",\n  hasTicks:       \"pe-slider--ticks\",\n  hasTrack:       \"pe-slider--track\",\n  isActive:       \"pe-slider--active\",\n  isAtMin:        \"pe-slider--min\",\n  isDisabled:     \"pe-slider--disabled\",\n  tickValue:      \"pe-slider__tick--value\",\n};\n","import { isTouch, pointerStartMoveEvent, pointerMoveEvent, pointerEndMoveEvent, isClient, filterSupportedAttributes, getStyle } from \"polythene-core\";\nimport classes from \"polythene-css-classes/slider\";\n\nconst MAX_TICKS = 100;\nlet focusElement;\n\nconst deFocus = state => {\n  if (focusElement) {\n    focusElement.blur();\n  }\n  focusElement = undefined;\n  state.hasFocus(false);\n};\n\nconst focus = (state, el) => {\n  deFocus(state);\n  focusElement = el;\n  state.hasFocus(true);\n};\n\nconst positionFromEvent = (e, isVertical) => (\n  // isVertical not yet implemented\n  isTouch && e.touches\n    ? isVertical ? e.touches[0].pageY : e.touches[0].pageX\n    : isVertical ? e.pageY : e.pageX);\n\nconst updatePinPosition = state => {\n  if (state.controlEl && state.pinEl) {\n    const left = state.fraction() * state.rangeWidth;\n    state.pinEl.style.left = left + \"px\";\n  }\n};\n\nconst updateValue = (state, value) => {\n  state.setValue(value, true);\n  updatePinPosition(state);\n};\n\nconst generateTickMarks = (h, stepCount, stepSize, value) => {\n  const items = [];\n  const stepWithValue = value / stepSize;\n  let s = 0;\n  while (s < stepCount + 1) {\n    items.push(h(\"div\", {\n      className: s <= stepWithValue\n        ? [classes.tick, classes.tickValue].join(\" \")\n        : classes.tick,\n      key: `tick-${s}`\n    }));\n    s++;\n  }\n  return items;\n};\n\nconst readRangeData = state => {\n  if (state.controlEl && isClient) {\n    // range is from the far left to the far right minus the thumb width (max x is at the left side of the thumb)\n    state.controlWidth = parseFloat(getStyle({ element: state.controlEl, prop: \"width\" }));\n    state.rangeWidth = state.trackEl.getBoundingClientRect().width - state.controlWidth;\n    const styles = window.getComputedStyle(state.trackEl);\n    state.rangeOffset = parseFloat(styles.marginLeft);\n  }\n};\n\nconst calculateClickOffset = (state, controlOffset = 0) => {\n  state.clickOffset = state.trackEl.getBoundingClientRect().left - (state.rangeOffset - state.controlWidth / 2) + controlOffset;\n};\n\nconst initControlEvent = (state, e) => {\n  const controlPos = state.controlEl.getBoundingClientRect().left;\n  const eventPos = positionFromEvent(e);\n  const controlOffset = eventPos - controlPos - state.controlWidth / 2;\n  calculateClickOffset(state, controlOffset);\n};\n\nconst initTrackEvent = (state) =>\n  calculateClickOffset(state, 0);\n\nconst handlePosEvent = (state, e) => {\n  const pos = positionFromEvent(e) - state.clickOffset;\n  const value = state.min + ((pos - state.rangeOffset) / state.rangeWidth) * (state.max - state.min);\n  updateValue(state, value);\n};\n\nconst startDrag = (state, attrs, e) => {\n  if (state.isDragging()) return;\n  e.preventDefault();\n  state.isDragging(true);\n  state.isActive(true);\n  deFocus(state);\n\n  const drag = e => {\n    if (!state.isDragging()) return;\n    handlePosEvent(state, e);\n  };\n\n  const endDrag = () => {\n    if (!state.isDragging()) return;\n    deFocus(state);\n    if (isClient) {\n      pointerMoveEvent.forEach(evt =>\n        window.removeEventListener(evt, drag));\n      pointerEndMoveEvent.forEach(evt =>\n        window.removeEventListener(evt, endDrag));\n    }\n    state.isDragging(false);\n    state.isActive(false);\n  };\n\n  if (isClient) {\n    pointerMoveEvent.forEach(evt =>\n      window.addEventListener(evt, drag));\n    pointerEndMoveEvent.forEach(evt =>\n      window.addEventListener(evt, endDrag));\n  }\n  readRangeData(state);\n\n  if (attrs.pin) {\n    updatePinPosition(state);\n  }\n};\n\nconst startTrack = (state, attrs, e) => {\n  e.preventDefault();\n  if (state.isDragging()) {\n    return;\n  }\n  readRangeData(state);\n  initTrackEvent(state);\n  handlePosEvent(state, e);\n  startDrag(state, attrs, e);\n};\n\nconst createSlider = (vnode, { h, k, hasTicks, interactiveTrack }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  const fraction = state.fraction();\n  const range = state.max - state.min;\n  const stepCount = Math.min(MAX_TICKS, parseInt(range / state.stepSize, 10));\n\n  const onStartTrack = e => (\n    startTrack(state, attrs, e)\n  );\n\n  const onInitDrag = e => {\n    readRangeData(state);\n    initControlEvent(state, e);\n    startDrag(state, attrs, e);\n  };\n\n  const flexValueCss =  fraction + \" 1 0%\";\n  const flexRestValue = 1 - fraction;\n  const flexRestCss =   flexRestValue + \" 1 0%\";\n\n  return h(\"div\",\n    Object.assign(\n      {},\n      { className: classes.track },\n      interactiveTrack && !attrs.disabled && pointerStartMoveEvent.reduce((acc, evt) => (\n        acc[k[`on${evt}`]] = onStartTrack,\n        acc\n      ), {})\n    ),\n    [\n      h(\"div\",\n        {\n          className: classes.trackPart + \" \" + classes.trackPartValue,\n          key: \"trackPartValue\",\n          style: {\n            flex: flexValueCss,\n            msFlex: flexValueCss,\n            WebkitFlex: flexValueCss\n          }\n        },\n        h(\"div\", { className: classes.trackBar },\n          h(\"div\", { className: classes.trackBarValue })\n        )\n      ),\n      h(\"div\", Object.assign(\n        {},\n        {\n          className: classes.control,\n          key: \"control\"\n        },\n        attrs.disabled\n          ? { disabled: true }\n          : {\n            [k.tabindex]: attrs[k.tabindex] || 0,\n            [k.onfocus]: () => focus(state, state.controlEl),\n            [k.onblur]: () => deFocus(state),\n            [k.onkeydown]: e => {\n              if (e.key !== \"Tab\") {\n                e.preventDefault();\n              }\n              if (e.key === \"Escape\" || e.key === \"Esc\") {\n                state.controlEl.blur(e);\n              } else if (e.key === \"ArrowLeft\" || e.key === \"ArrowDown\" || e.key === \"Left\" || e.key === \"Down\") {\n                state.decrement(state, e.shiftKey);\n              } else if (e.key === \"ArrowRight\" || e.key === \"ArrowUp\" || e.key === \"Right\" || e.key === \"Up\") {\n                state.increment(state, e.shiftKey);\n              } else if (e.key === \"Home\") {\n                updateValue(state, state.min);\n              } else if (e.key === \"End\") {\n                updateValue(state, state.max);\n              } else if (e.key === \"PageDown\") {\n                state.decrement(state, true);\n              } else if (e.key === \"PageUp\") {\n                state.increment(state, true);\n              }\n              readRangeData(state);\n              updatePinPosition(state);\n            }\n          },\n        !attrs.disabled &&\n          pointerStartMoveEvent.reduce((acc, evt) => (\n            acc[k[`on${evt}`]] = onInitDrag,\n            acc\n          ), {}),\n        attrs.events\n          ? attrs.events\n          : null,\n        hasTicks\n          ? { step: stepCount }\n          : null\n      ),\n      attrs.icon\n        ? h(\"div\",\n          {\n            className: classes.thumb,\n            key: \"icon\"\n          },\n          attrs.icon\n        )\n        : null\n      ),\n      h(\"div\",\n        {\n          className: classes.trackPart + \" \" + classes.trackPartRest,\n          key: \"trackPartRest\",\n          style: {\n            flex: flexRestCss,\n            msFlex: flexRestCss,\n            WebkitFlex: flexRestCss,\n            maxWidth: (flexRestValue * 100) + \"%\" // for IE Edge\n          }\n        },\n        h(\"div\", { className: classes.trackBar },\n          h(\"div\", { className: classes.trackBarValue })\n        )\n      ),\n      hasTicks && !attrs.disabled\n        ? h(\"div\",\n          {\n            className: classes.ticks,\n            key: \"ticks\"\n          },\n          generateTickMarks(h, stepCount, state.stepSize, state.value())\n        )\n        : null,\n      hasTicks && attrs.pin && !attrs.disabled\n        ? h(\"div\",\n          {\n            className: classes.pin,\n            key: \"pin\",\n            value: state.value()\n          }\n        )\n        : null\n    ]\n  );\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const attrs = vnode.attrs;\n\n  const min = attrs.min !== undefined ? attrs.min : 0;\n  const max = attrs.max !== undefined ? attrs.max : 100;\n  const range = max - min;\n  const stepSize = attrs.stepSize !== undefined\n    ? attrs.stepSize\n    : 1;\n  const defaultValue = attrs.defaultValue !== undefined\n    ? attrs.defaultValue\n    : attrs.value !== undefined\n      ? attrs.value\n      : 0;\n  const previousValue = createStream(undefined);\n  const isActive = createStream(false);\n  const hasFocus = createStream(false);\n  const isDragging = createStream(false);\n  const fraction = createStream(min);\n  const value = createStream(0);\n  const normalizeFactor = 1 / stepSize;\n\n  const setValue = (v, shouldNotify = false) => {\n    if (v < min) v = min;\n    if (v > max) v = max;\n    value(stepSize\n      ? Math.round(v * normalizeFactor) / normalizeFactor\n      : v\n    );\n    fraction((value() - min) / range);\n    if (shouldNotify && attrs.onChange) {\n      attrs.onChange({\n        value: value()\n      });\n    }\n    previousValue(v);\n  };\n\n  const increment = (state, useLargeStep) =>\n    updateValue(state, value() + (useLargeStep ? 10 : 1) * (stepSize || 1));\n\n  const decrement = (state, useLargeStep) =>\n    updateValue(state, value() - (useLargeStep ? 10 : 1) * (stepSize || 1));\n  \n  setValue(defaultValue);\n  \n  return {\n    min,\n    max,\n    stepSize,\n    fraction,\n    // DOM elements\n    trackEl: null,\n    controlEl: null,\n    pinEl: null,\n    // functions\n    setValue,\n    increment,\n    decrement, \n    // streams\n    isDragging,\n    isActive,\n    value,\n    previousValue,\n    hasFocus,\n    // coordinates\n    controlWidth: 0,\n    rangeWidth: 0,\n    rangeOffset: 0,\n    clickOffset: 0,\n    redrawOnUpdate: createStream.merge([isActive, value])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const dom = vnode.dom;\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  state.trackEl = dom.querySelector(`.${classes.track}`);\n  state.controlEl = dom.querySelector(`.${classes.control}`);\n  state.pinEl = dom.querySelector(`.${classes.pin}`);\n\n  readRangeData(state);\n\n  if (attrs.pin) {\n    setTimeout(() => {\n      updateValue(state, state.value());\n    }, 0);\n  }\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  if (attrs.value !== undefined) {\n    if (state.previousValue() !== attrs.value) {\n      state.previousValue(attrs.value);\n      setTimeout(() => state.setValue(state.previousValue()), 0); // perform in next tick to play nice with React\n    }\n  }\n  const hasTicks = attrs.ticks !== undefined && attrs.ticks !== false;\n  const interactiveTrack = (attrs.interactiveTrack !== undefined) ? attrs.interactiveTrack : true;\n  return Object.assign(\n    {}, \n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.disabled ? classes.isDisabled : null,\n        attrs.pin ? classes.hasPin : null,\n        interactiveTrack ? classes.hasTrack : null,\n        state.isActive() ? classes.isActive : null,\n        state.hasFocus() ? classes.hasFocus : null,\n        state.fraction() === 0 ? classes.isAtMin : null,\n        hasTicks ? classes.hasTicks : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, keys: k }) => {\n  const attrs = vnode.attrs;\n  const hasTicks = attrs.ticks !== undefined && attrs.ticks !== false;\n  const interactiveTrack = (attrs.interactiveTrack !== undefined) ? attrs.interactiveTrack : true;\n  return createSlider(vnode, { h, k, hasTicks, interactiveTrack });\n};\n\n\n"],"names":["component","control","label","pin","thumb","tick","ticks","track","trackBar","trackBarValue","trackPart","trackPartRest","trackPartValue","hasFocus","hasPin","hasTicks","hasTrack","isActive","isAtMin","isDisabled","tickValue","MAX_TICKS","focusElement","deFocus","blur","undefined","state","focus","el","positionFromEvent","e","isVertical","isTouch","touches","pageY","pageX","updatePinPosition","controlEl","pinEl","left","fraction","rangeWidth","style","updateValue","value","setValue","generateTickMarks","h","stepCount","stepSize","items","stepWithValue","s","push","className","classes","join","key","readRangeData","isClient","controlWidth","parseFloat","getStyle","element","prop","trackEl","getBoundingClientRect","width","styles","window","getComputedStyle","rangeOffset","marginLeft","calculateClickOffset","controlOffset","clickOffset","initControlEvent","controlPos","eventPos","initTrackEvent","handlePosEvent","pos","min","max","startDrag","attrs","isDragging","preventDefault","drag","endDrag","pointerMoveEvent","forEach","removeEventListener","evt","pointerEndMoveEvent","addEventListener","startTrack","createSlider","vnode","k","interactiveTrack","range","Math","parseInt","onStartTrack","onInitDrag","flexValueCss","flexRestValue","flexRestCss","disabled","pointerStartMoveEvent","reduce","acc","flex","msFlex","WebkitFlex","tabindex","onfocus","onblur","onkeydown","decrement","shiftKey","increment","events","step","icon","maxWidth","getInitialState","createStream","defaultValue","previousValue","normalizeFactor","v","shouldNotify","round","onChange","useLargeStep","redrawOnUpdate","merge","onMount","dom","querySelector","setTimeout","createProps","keys","filterSupportedAttributes","tone","class","createContent","renderer"],"mappings":"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"}